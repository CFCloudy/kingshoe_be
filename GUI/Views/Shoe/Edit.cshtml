@model GUI.Models.Shoe

@{
    ViewData["Title"] = "Edit";
}

<h1>Edit</h1>

<h4>Shoe</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form asp-action="Edit">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <input type="hidden" asp-for="Id" />
            <input type="hidden" asp-for="Status" />
            <input type="hidden" asp-for="CreatedAt" />
            <div class="form-group">
                <label asp-for="ProductName" class="control-label">Tên sản phẩm</label>
                <input asp-for="ProductName" class="form-control" />
                <span asp-validation-for="ProductName" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="DisplayPrice" class="control-label">Giá bán</label>
                <input asp-for="DisplayPrice" class="form-control" />
                <span asp-validation-for="DisplayPrice" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="BrandGroup" class="control-label">Tên thương hiệu</label>
                <select asp-for="BrandGroup" class="form-control" asp-items="ViewBag.BrandGroup"></select>
                <span asp-validation-for="BrandGroup" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Feature" class="control-label">Tên tính năng</label>
                <select asp-for="Feature" class="form-control" asp-items="ViewBag.Feature"></select>
                <span asp-validation-for="Feature" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="StyleGroup" class="control-label">Tên phong cách</label>
                <select asp-for="StyleGroup" class="form-control" asp-items="ViewBag.StyleGroup"></select>
                <span asp-validation-for="StyleGroup" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="DisplayImage" class="control-label">Hình ảnh</label>
                <br />
                @Html.TextBox("fileImage", "", new { type = "file", accept = "image/*" })
                <br />
                @if (Model.ImageURL == null)
                {
                    <img class="d-none" id="preview" src="#" width="150" height="100" />
                }
                else
                {
                    <img id="preview" src="@Model.ImageURL" width="150" height="100" />
                }
                <input name="image" id="image" hidden class="form-control" />
            </div>
            <div class="form-group">
                <label asp-for="IsHotProduct" class="control-label"></label>
                <input asp-for="IsHotProduct" class="form-control" />
                <span asp-validation-for="IsHotProduct" class="text-danger"></span>
            </div>
            <div class="form-group">
                <input type="submit" value="Save" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    }
<script>

    fileImage.onchange = evt => {
        const [file] = fileImage.files

        if (file) {

            preview.src = URL.createObjectURL(file);
            toDataURL(URL.createObjectURL(file), function (dataUrl) {
                var obj = {
                    name: file.name,
                    base64: dataUrl,
                    type: file.type
                }
                console.log(dataUrl)
                document.getElementById("image").value = JSON.stringify(obj);
                $("#preview").removeClass("d-none");
            })
        }
    }
    function toDataURL(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.onload = function () {
            var reader = new FileReader();
            reader.onloadend = function () {
                callback(reader.result);
            }
            reader.readAsDataURL(xhr.response);
        };
        xhr.open('GET', url);
        xhr.responseType = 'blob';
        xhr.send();
    }

</script>
